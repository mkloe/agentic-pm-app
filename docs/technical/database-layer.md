# Database Layer

## Overview

The app uses a single JSON file (`data/db.json`) as its database. All reads and writes go through `lib/db.ts`, which provides typed CRUD functions using synchronous `fs` operations.

## Storage File

**Path**: `data/db.json`

Generated by the seed script (`pnpm seed`). Must exist before the app can operate. The file is read and written in its entirety on every operation (read-modify-write pattern).

## CRUD Functions (`lib/db.ts`)

### Internal Helpers

| Function | Description |
|----------|-------------|
| `readDb()` | Reads and parses `db.json`, returns typed `Database` object |
| `writeDb(db)` | Serializes and writes the full `Database` to `db.json` |

### Projects

| Function | Signature | Description |
|----------|-----------|-------------|
| `getProjects` | `() => Project[]` | Returns all projects |
| `getProject` | `(id: string) => Project \| undefined` | Find project by ID |
| `createProject` | `(data) => Project` | Create project, auto-generates `id` (UUID), `createdAt`, `updatedAt` |
| `updateProject` | `(id, data) => Project \| null` | Partial update, auto-sets `updatedAt` |
| `deleteProject` | `(id: string) => boolean` | Deletes project **and** all its tasks (cascade) |

### Tasks

| Function | Signature | Description |
|----------|-----------|-------------|
| `getTasks` | `(filters?) => Task[]` | List tasks with optional `projectId`, `status`, `priority` filters. Sorted by `order` ascending |
| `getTask` | `(id: string) => Task \| undefined` | Find task by ID |
| `createTask` | `(data) => Task` | Create task, auto-generates `id`, `createdAt`, `updatedAt` |
| `updateTask` | `(id, data) => Task \| null` | Partial update, auto-sets `updatedAt` |
| `deleteTask` | `(id: string) => boolean` | Delete a single task |
| `reorderTasks` | `(updates[]) => void` | Bulk update `status` and `order` for multiple tasks (used by drag-and-drop) |

### Team & Labels

| Function | Signature | Description |
|----------|-----------|-------------|
| `getTeamMembers` | `() => TeamMember[]` | Returns all team members |
| `getLabels` | `() => Label[]` | Returns all labels |

## ID Generation

New entities receive a UUID via `crypto.randomUUID()`.

## Seed Script (`scripts/seed.ts`)

Run with `pnpm seed`. Creates `data/db.json` with:

| Entity | Count | Details |
|--------|-------|---------|
| Projects | 1 | "Agentic PM App" (key: PM) |
| Team Members | 5 | Sarah Chen (PM), Marcus Johnson (Frontend), Aisha Patel (Backend), Tom Wilson (Design), Elena Rodriguez (Full-Stack) |
| Labels | 6 | Bug, Feature, Enhancement, Documentation, Design, Tech Debt |
| Tasks | 18 | Spread across all statuses and priorities, assigned to various team members |

The script creates the `data/` directory if it doesn't exist.

## Utility Functions (`lib/utils.ts`)

| Function | Signature | Description |
|----------|-----------|-------------|
| `cn` | `(...inputs: ClassValue[]) => string` | Merges Tailwind classes (clsx + tailwind-merge) |
| `generateId` | `() => string` | Random ID (not used for DB entities; UUID is used instead) |
| `formatDate` | `(date: string \| null) => string` | Formats ISO date to "Mon DD, YYYY" |
| `getInitials` | `(name: string) => string` | Extracts 2-letter uppercase initials from a name |
| `isOverdue` | `(dueDate: string \| null) => boolean` | Returns true if date is past and non-null |

## Constants (`lib/constants.ts`)

| Export | Type | Description |
|--------|------|-------------|
| `STATUS_CONFIG` | `Record<Status, {label, color, bgColor}>` | Display config for each status |
| `PRIORITY_CONFIG` | `Record<Priority, {label, color, bgColor}>` | Display config for each priority |
| `ROLE_LABELS` | `Record<Role, string>` | Human-readable role names |
| `STATUSES` | `Status[]` | Ordered array of all status values |
| `PRIORITIES` | `Priority[]` | Ordered array of all priority values |
| `CHART_COLORS` | `Record<string, string>` | Hex colors for Recharts (status + priority keys) |
